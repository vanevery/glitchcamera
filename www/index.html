<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<style>
		#img {
			width: 90%;
			height: auto;
		}
	</style>
        <script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript">
		var originalImageData = null;
		var originalImageElement = null;

		var glitchedImages = [];
	
		function onLoad() {
			document.addEventListener('deviceready', onDeviceReady);
		}

		function onDeviceReady() {
			originalImageElement = document.getElementById('original');
			takePicture();
		}

		function takePicture() {
			navigator.camera.getPicture(onTakePictureSuccess, onTakePictureFail, { 
				quality: 50,
				targetWidth: 640,
				targetHeight: 480,
				saveToPhotoAlbum: false,
    				destinationType: Camera.DestinationType.DATA_URL
			});			
		}

		function onTakePictureSuccess(imageData) {
			originalImageData = imageData;
   			originalImageElement.src = "data:image/jpeg;base64," + originalImageData;

			createGlitches(originalImageData);
		}

		function onTakePictureFail(message) {
    			alert('Failed because: ' + message);
		}

		function createGlitches(originalImageData) {
			glitchedImages[0] = {};
			glitchedImages[0].imageData = originalImageData;

			// Glitch Operation
			var copyFromStart = Math.random() * glitchedImages[0].imageData.length;
			var copyFromLength = Math.random() * (glitchedImages[0].imageData.length - copyFromStart)/2;
			var copyData = glitchedImages[0].imageData.substr(copyFromStart, copyFromLength);
			glitchedImages[0].imageData = glitchedImages[0].imageData.substr(0, glitchedImages[0].imageData.length - copyFromStart) + copyData + copyData;
			glitchedImages[0].imageElement = document.createElement('img');
			glitchedImages[0].imageElement.setAttribute('src', "data:image/jpeg;base64," + glitchedImages[0].imageData);
			document.appendChild(glitchedImages[0].imageElement);
		}

		window.addEventListener('load', onLoad);
	</script>
        <title>Glitch Camera</title>
    </head>
    <body>
        <div class="app">
            <h1>Glitch Camera</h1>
		<img src="" id="original" />
        </div>
    </body>
</html>
